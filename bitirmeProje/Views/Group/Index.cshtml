@using bitirmeProje.Domain.Entities;
@using bitirmeProje.Dto;
@{
    var groupInfoList = ViewBag.GroupInfo as List<SurveyInfoDto>;
    var group = ViewBag.Group as Group;
    var user = ViewBag.User as User;
    var IsMember = ViewBag.IsMember as GroupUser;
    var Role = ViewBag.Role as Role;
    var UserRequest = ViewBag.UserRequest as List<User>;
    var AllGroupUsers = ViewBag.AllGroupUsers as List<UserRoleDto>;
}

<title>Group Home Page</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
    <style>
    /* Düzenli içerik container'ı */
    .page-container {
        display: flex;
        justify-content: center; /* Yatayda ortalama */
        align-items: center; /* Dikeyde ortalama */
        height: 100vh; /* Sayfa boyutunda genişlik */
    }

    /* İçerik container'ının içindeki içerikleri düzenleme */
    .content-container {
        flex-grow: 1; /* İçeriğin tamamını kaplaması için */
        max-width: 800px; /* Maksimum genişlik ayarı */
    }
</style>
</style>
<!-- Flex Düzeni ile Sidebar ve Merkez İçeriği -->
<div class="h-full">

    <!-- h-full, merkezi tüm sayfa yüksekliğine yayar -->
    <!-- Sol Sidebar (Üyeler) -->
@*     <div class="w-2/6 bg-white p-6 rounded-lg shadow-md border-r overflow-y-auto" style="max-height: 100vh;">
        <!-- overflow-y-auto ile dikey kaydırma -->

        <h2 class="text-2xl font-bold mb-4">Üyeler</h2>
        <span class="text-gray-500 mb-4">Toplam Üye: 100</span> <!-- Toplam üye sayısı Sidebar'ın üstünde -->
        <div class="flex flex-col space-y-4">
            <!-- Üyeler yukarıdan aşağıya doğru listelenir -->
            <div class="flex items-center">
                <img src="https://via.placeholder.com/50" alt="Member" class="w-12 h-12 rounded-full">
                <p class="ml-4 text-gray-600">Üye Adı</p>

            </div>
            <!-- Diğer üyeler için benzer yapı -->
        </div>
    </div> *@
    @if (groupInfoList != null)
    {
        <div class="m-auto bg-white p-6 rounded-lg shadow-md mt-10 m-12 p-6 flex flex-col justify-start" style="min-height: 100vh; width:60%">
            <!-- Min-height ile sabit yükseklik -->
            <!-- Grup Fotoğrafı ve Grup Adı Yan Yana -->
            <div class="flex items-center mb-4">
                <img src="https://via.placeholder.com/100" alt="Group Photo" class="w-24 h-24 rounded-full object-cover">
                <h1 class="text-3xl font-bold ml-4">@group.GroupName</h1>
                <input type="hidden" name="groupId" id="groupId" value="@group.Id">
                <input type="hidden" name="userId" id="userId" value="@user">
            </div>

            <!-- Üye Ol Butonu -->
            <div class="flex items-center justify-between mb-4">
                <p class="text-gray-600">@group.GroupDescription</p>
                @if (Role.RoleName != "Yönetici")
                {
                    <a href="#" id="membershipButton" class="bg-blue-500 text-white px-4 py-2 rounded">Üye Ol</a> <!-- Üye Ol butonu sağda -->
                }
            </div>

            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Profil</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Anketler</button>
                </li>
                @if (Role.RoleName == "Yönetici")
                {
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="userRequest-tab" data-bs-toggle="tab" data-bs-target="#userRequest" type="button" role="tab" aria-controls="userRequest" aria-selected="false">İstekler</button>
                    </li>
                }
                @if ((IsMember != null && IsMember.IsMember == true && IsMember.IsActive == true) || (group.Private == true))
                {
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">Üyeler</button>
                </li>
                }
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">...</div>
                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    @if ((IsMember != null && IsMember.IsMember == true && IsMember.IsActive == true) || (group.Private == true))
                    {
                        @await Component.InvokeAsync("SurveyComponent", group.Id)
                    }
                    else
                    {
                        <h1>Grup Gizli Bir Gruptur. Anketleri Görebilmek İçin Üye Olunuz.</h1>
                    }
                </div>
                <div class="tab-pane fade" id="userRequest" role="tabpanel" aria-labelledby="userRequest-tab">
                    @if (UserRequest.Any() == false)
                    {
                        <h1>İstek bulunmamaktadır.</h1>
                    }
                    else
                    {
                        <table class="table table-striped table-hover">
                            <!-- Çizgili ve üzerine gelince renk değiştiren tablo -->
                            <thead class="table-dark">
                                <!-- Koyu arka planlı başlık -->
                                <tr>
                                    <th>Kullanıcı Adı</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in UserRequest)
                                {
                                    <tr>
                                        <td>@item.Name @item.Surname</td> <!-- Kullanıcı adını göster -->
                                        <td hidden>@item.Id</td>
                                        <td>
                                            <!-- Buton ve ikon kullanımı -->
                                            <button type="button"
                                                    class="btn btn-success btn-sm"
                                                    onclick="UserRequestApproval(this,'@item.Id','@group.Id')">
                                                <!-- Onayla butonu -->
                                                <i class="fas fa-check"></i> <!-- Font Awesome ile onay ikonu -->
                                                Onayla
                                            </button>
                                            <button type="button"
                                                    class="btn btn-danger btn-sm"
                                                    onclick="UserRequestRejection(this,'@item.Id','@group.Id')">
                                                <!-- red butonu -->
                                                <i class="fa-solid fa-x"></i>
                                                Reddet
                                            </button>
                                            <!-- Diğer işlemler için başka butonlar eklenebilir -->
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
                <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                    <body>
                        <div class="container">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Adı</th>
                                        <th>Soyadı</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in AllGroupUsers)
                                    {
                                        <tr>
                                            <td>@item.Name</td>
                                            <td>@item.Surname</td>
                                            <td>
                                                <button type="button" class="btn btn-danger btn-sm" onclick="UserRequestRejection(this,'@item.UserId','@group.Id')">X Üyelikten çıkar</button>
                                                @if (item.RoleName=="Yönetici")
                                                {
                                                    <button type="button" name="TakeGroupAdminButton" class="btn btn-success btn-sm" onclick="TakeGroupAdmin(this,'@item.UserId','@group.Id')">Grup Yöneticisi</button>
                                                }
                                                else
                                                {
                                                    <button type="button" class="btn btn-success btn-sm" name="MakeGroupAdminButton" onclick="MakeGroupAdmin(this,'@item.UserId','@group.Id')">Grup Yöneticisi Yap</button>

                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </body>
                </div>

            </div>
        </div>
    }
</div>
<script src="~/js/group.js"></script>


